<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kemahiran Pemulihan: Eksplorasi Tolak (Tanpa Kuiz)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    .activity-card { min-height: 460px; }
    .tile { transition:.2s; }
    .tile:hover { transform: translateY(-2px); }
    .trail { background:#dbeafe !important; border-color:#93c5fd !important; }
    .here  { background:#bbf7d0 !important; border-color:#22c55e !important; font-weight:700; }
    .rod   { width:28px; height:160px; border-radius:8px; }
    .unit  { width:28px; height:28px; border-radius:9999px; }
    .pulse { animation:pulse 1.2s ease infinite; }
    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.06)} 100%{transform:scale(1)} }
    .step { transition:background .3s, color .3s, transform .2s; }
    .step:active { transform: scale(0.98); }
    .colcell { width:84px; height:56px; display:flex; align-items:center; justify-content:center;
               border-radius:.75rem; border:2px solid #e5e7eb; background:#f8fafc; font-weight:700; }
    .hl { outline:3px solid #f59e0b; background:#fff7ed !important; }
    .story-obj { width:56px; height:56px; display:inline-flex; align-items:center; justify-content:center;
                 border-radius:14px; background:#fff; border:2px solid #e5e7eb; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-full">

  <!-- Info bar -->
  <div class="bg-yellow-100 border-b-4 border-yellow-300 p-4 shadow-sm sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ğŸ“š</span>
        <span id="info-text" class="text-lg font-semibold text-gray-800">
          Pilih aktiviti penerokaan untuk belajar tolak.
        </span>
      </div>
      <button id="speak-btn"
              class="bg-yellow-300 hover:bg-yellow-400 text-yellow-800 font-bold py-2 px-4 rounded-full text-xl transition-colors duration-200"
              onclick="speakInfo()">
        ğŸ”Š
      </button>
    </div>
  </div>

  <div class="max-w-6xl mx-auto p-6">
    <!-- Activity card -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 activity-card flex items-center justify-center">
      <div id="activity-content" class="text-center w-full">
        <div class="py-16">
          <div class="text-6xl mb-4">â–</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Eksplorasi Operasi Tolak</h2>
          <p class="text-lg text-gray-600 mb-6">Manipulatif, garis nombor, petak 100, bentuk lazim & cerita bergambar.</p>
          <div class="text-4xl">ğŸ‘‡</div>
        </div>
      </div>
    </div>

    <!-- Activity picker -->
    <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">Pilih Aktiviti</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-6">
        <button onclick="loadActivity(1)"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-lg">
          ğŸ“ Garis Nombor
        </button>
        <button onclick="loadActivity(2)"
                class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg text-lg">
          ğŸŸ¦ Petak 100
        </button>
        <button onclick="loadActivity(3)"
                class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg text-lg">
          ğŸ”Ÿ Puluh & Sa
        </button>
        <button onclick="loadActivity(4)"
                class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg">
          ğŸ§® Bentuk Lazim
        </button>
        <button onclick="loadActivity(5)"
                class="bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-4 rounded-lg text-lg">
          ğŸï¸ Cerita Bergambar
        </button>
      </div>

      <div class="flex justify-center gap-4">
        <button onclick="clearActivity()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg text-lg">
          ğŸ§¹ Bersih
        </button>
        <button onclick="nextActivity()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg text-lg">
          â¡ï¸ Seterusnya
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti penerokaan untuk belajar tolak.";

    /* ====== TTS ====== */
    function speak(text) {
      if (!ttsEnabled) return;
      if (!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(() => {
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ms-MY';
        u.rate = 0.95; u.pitch = 1.03;
        const ms = speechSynthesis.getVoices().find(v => v.lang?.startsWith('ms'));
        if (ms) u.voice = ms;
        window.speechSynthesis.speak(u);
      }, 100);
    }
    function setInfo(text) { currentInfo = text; document.getElementById('info-text').textContent = text; }
    function speakInfo() {
      if (!ttsEnabled) {
        ttsEnabled = true;
        const btn = document.getElementById('speak-btn');
        btn.classList.add('bg-green-300','hover:bg-green-400');
        btn.classList.remove('bg-yellow-300','hover:bg-yellow-400');
      }
      speak(currentInfo);
    }

    /* ===== Router ===== */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      if (n === 1) return loadNumberLine(content);
      if (n === 2) return loadHundredsGrid(content);
      if (n === 3) return loadBaseTen(content);
      if (n === 4) return loadColumnDemo(content);
      if (n === 5) return loadStory(content);
    }
    function clearActivity() {
      currentActivity = 0;
      document.getElementById('activity-content').innerHTML = `
        <div class="text-center py-16">
          <div class="text-6xl mb-4">â–</div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Eksplorasi Operasi Tolak</h2>
          <p class="text-lg text-gray-600 mb-6">Manipulatif, garis nombor, petak 100, bentuk lazim & cerita bergambar.</p>
          <div class="text-4xl">ğŸ‘‡</div>
        </div>`;
      setInfo("Pilih aktiviti penerokaan untuk belajar tolak.");
    }
    function nextActivity() {
      if (currentActivity === 0) return loadActivity(1);
      if (currentActivity < 5) return loadActivity(currentActivity + 1);
      return loadActivity(1);
    }
    const R = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;

    /* ===== 1) Garis Nombor Interaktif ===== */
    function loadNumberLine(content){
      const start = R(20,90);
      let pos = start;
      setInfo("Gerakkan penanda di garis nombor. Guna -1 atau -10 untuk meneroka tolak.");
      const marks = Array.from({length:11}, (_,i)=>start-50 + i*10); // labeling setiap 10
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-blue-700 mb-2">ğŸ“ Garis Nombor Interaktif</h3>
        <p class="text-gray-600 mb-4">Seret slider atau guna butang untuk melangkah ke kiri (tolak). Jejak akan dilukis.</p>

        <div class="max-w-3xl mx-auto">
          <div class="relative h-24">
            <div class="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-2 bg-blue-200 rounded-full"></div>
            <div id="ticks" class="absolute left-0 right-0 top-1/2 -translate-y-1/2 flex justify-between">
              ${marks.map(m=>`<div class="flex flex-col items-center">
                  <div class="w-[2px] h-6 bg-blue-400"></div>
                  <div class="text-xs text-gray-600 mt-1">${m}</div>
                </div>`).join('')}
            </div>
            <div id="runner" class="absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2">
              <div class="w-10 h-10 rounded-full bg-green-400 border-4 border-white shadow-lg flex items-center justify-center text-white font-black pulse">${pos}</div>
            </div>
          </div>

          <input id="nl-range" type="range" min="0" max="100" value="${start}" class="w-full my-4">
          <div class="flex flex-wrap gap-3 justify-center">
            <button class="step bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg" onclick="stepNL(-1)">âˆ’1</button>
            <button class="step bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg" onclick="stepNL(-10)">âˆ’10</button>
            <button class="step bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg" onclick="resetNL()">Reset</button>
          </div>
          <div class="text-center mt-3 text-sm text-gray-500">Kedudukan: <span id="nl-pos" class="font-semibold">${pos}</span></div>
        </div>
      `;
      const runner = document.getElementById('runner');
      const range  = document.getElementById('nl-range');
      const posTxt = document.getElementById('nl-pos');
      const trail  = [];

      function renderRunner(){
        // map 0..100 to line width
        const pct = (pos/100)*100;
        runner.style.left = `${pct}%`;
        runner.querySelector('div').textContent = pos;
        posTxt.textContent = pos;
      }
      window.stepNL = (d)=>{
        const old = pos;
        pos = Math.max(0, Math.min(100, pos + d));
        trail.push(pos);
        renderRunner();
        speak(`${old} tolak ${Math.abs(d)} menjadi ${pos}`);
      };
      window.resetNL = ()=>{ pos=start; trail.length=0; renderRunner(); speak("Kembali ke nombor mula."); };
      range.addEventListener('input', (e)=>{ pos=+e.target.value; renderRunner(); });
      renderRunner();
    }

    /* ===== 2) Petak 100 â€“ Jelajah Tolak ===== */
    function loadHundredsGrid(content){
      let start = R(21,100);
      let here  = start;
      setInfo("Klik petak mula, kemudian guna langkah âˆ’1 atau âˆ’10 untuk jelajah. Jejak berwarna membantu visualkan tolak.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-emerald-700 mb-2">ğŸŸ¦ Petak 100 â€“ Jelajah Tolak</h3>
        <div class="flex flex-col md:flex-row gap-4">
          <div class="flex-1">
            <div class="grid grid-cols-10 gap-2">
              ${Array.from({length:100},(_,i)=>i+1).map(n=>`
                <button id="cell-${n}" class="tile border-2 rounded-lg px-2 py-3 text-sm ${n<=start? 'bg-blue-50 border-blue-200':'bg-white border-gray-200'}"
                        onclick="jumpTo(${n})">${n}</button>
              `).join('')}
            </div>
          </div>
          <div class="w-full md:w-64">
            <div class="bg-white border rounded-xl p-4 sticky top-4">
              <div class="text-sm text-gray-500">Soalan eksplorasi</div>
              <div class="text-2xl font-black text-emerald-700 my-1"><span id="p100-a">${start}</span> âˆ’ <span id="p100-b">1</span> = <span id="p100-c">${start-1}</span></div>

              <div class="flex flex-wrap gap-2 my-2">
                <button class="step bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg" onclick="moveGrid(-1)">âˆ’1</button>
                <button class="step bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg" onclick="moveGrid(-10)">âˆ’10</button>
                <button class="step bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg" onclick="resetGrid()">Reset</button>
              </div>
              <div class="text-sm text-gray-600">Petua: âˆ’1 = bergerak <b>ke kiri</b>, âˆ’10 = bergerak <b>naik satu baris</b>.</div>
            </div>
          </div>
        </div>
      `;
      function colorTrail(from,to){
        const cf = document.getElementById(`cell-${from}`);
        const ct = document.getElementById(`cell-${to}`);
        if(cf) cf.classList.add('trail');
        if(ct) { ct.classList.add('here'); setTimeout(()=>ct.classList.remove('here'),700); }
      }
      window.moveGrid = (d)=>{
        const old=here; const next = Math.max(1, Math.min(100, here + d));
        here=next; colorTrail(old,next);
        document.getElementById('p100-a').textContent = old;
        document.getElementById('p100-b').textContent = Math.abs(d);
        document.getElementById('p100-c').textContent = next;
        speak(`${old} tolak ${Math.abs(d)} jadi ${next}`);
      };
      window.resetGrid = ()=>{
        document.querySelectorAll('[id^="cell-"]').forEach(el=>el.classList.remove('trail','here'));
        here=start; colorTrail(start,start); speak("Reset petak 100.");
        document.getElementById('p100-a').textContent=start;
        document.getElementById('p100-b').textContent=1;
        document.getElementById('p100-c').textContent=start-1;
      };
      window.jumpTo = (n)=>{
        start=n; here=n; resetGrid();
        setInfo(`Mula di ${n}. Cuba tolak 1 atau 10 dan lihat pergerakan pada petak.`);
      };
      colorTrail(start,start);
    }

    /* ===== 3) Blok Puluh & Sa â€“ Manipulatif ===== */
    function loadBaseTen(content){
      let tens = R(1,9), ones = R(0,9);
      if(tens*10+ones < 12) tens = 3, ones = 4; // elak terlalu kecil
      let start = tens*10 + ones;
      let remain = start;

      setInfo("Klik butang keluarkan 1 (sa) atau 10 (puluh). Lihat bilangan yang tinggal.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-purple-700 mb-2">ğŸ”Ÿ Blok Puluh & Sa (Manipulatif)</h3>
        <div class="flex flex-col lg:flex-row gap-6">
          <div class="flex-1">
            <div class="text-sm text-gray-500 mb-2">Nombor mula</div>
            <div class="text-3xl font-black text-purple-700 mb-4"><span id="bt-start">${start}</span></div>

            <div class="flex flex-wrap gap-3 items-end mb-3" id="bt-visual">
              ${Array.from({length:tens},()=>`<div class="rod bg-purple-300 border-2 border-purple-400"></div>`).join('')}
              ${Array.from({length:ones},()=>`<div class="unit bg-purple-200 border-2 border-purple-400"></div>`).join('')}
            </div>

            <div class="flex flex-wrap gap-3">
              <button class="step bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg" onclick="btTake(1)">Keluarkan 1</button>
              <button class="step bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg" onclick="btTake(10)">Keluarkan 10</button>
              <button class="step bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg" onclick="btReset()">Reset</button>
            </div>
          </div>

          <div class="w-full lg:w-72">
            <div class="bg-white border rounded-xl p-4">
              <div class="text-sm text-gray-500">Bentuk ayat matematik</div>
              <div class="text-2xl font-black text-purple-700 my-1">
                <span id="bt-a">${start}</span> âˆ’ <span id="bt-b">0</span> = <span id="bt-c">${start}</span>
              </div>
              <div class="text-sm text-gray-600 mt-2">Tolak 1 akan mengurangkan <b>sa</b>. Tolak 10 akan mengurangkan <b>puluh</b>.</div>
            </div>
          </div>
        </div>
      `;
      window.btTake = (n)=>{
        const vis = document.getElementById('bt-visual');
        let removed = 0;
        if(n===1 && vis.querySelector('.unit')){
          vis.querySelector('.unit')?.remove(); removed=1;
        }else if(n===10 && vis.querySelector('.rod')){
          vis.querySelector('.rod')?.remove(); removed=10;
        }else{
          setInfo("Tiada lagi blok yang sesuai untuk dikeluarkan.");
          speak("Tiada lagi blok.");
          return;
        }
        remain -= removed;
        document.getElementById('bt-b').textContent = (parseInt(document.getElementById('bt-b').textContent)||0) + removed;
        document.getElementById('bt-c').textContent = remain;
        setInfo(`${removed} dikeluarkan. Tinggal ${remain}.`);
        speak(`${removed} dikeluarkan. Tinggal ${remain}.`);
      };
      window.btReset = ()=>loadBaseTen(content);
    }

    /* ===== 4) Bentuk Lazim â€“ Demo Langkah ===== */
    function loadColumnDemo(content){
      // pastikan tanpa pinjam semula
      let A, B;
      do { A=R(20,99); B=R(10,A-1); } while( (A%10) < (B%10) );
      const tA=Math.floor(A/10), oA=A%10, tB=Math.floor(B/10), oB=B%10;
      const ans=A-B;
      setInfo("Tekan butang 'Tunjuk Langkah' untuk melihat proses tolak ikut lajur (tanpa pinjam).");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-orange-600 mb-2">ğŸ§® Bentuk Lazim â€“ Demo Langkah</h3>
        <p class="text-gray-600 mb-3">Fokus faham proses, bukan menjawab. Lihat sorotan pada lajur Puluh & Sa.</p>

        <div class="flex flex-col md:flex-row items-start gap-6">
          <div>
            <div class="grid grid-cols-2 gap-2 text-center mb-1">
              <div class="text-sm text-gray-500">Puluh</div>
              <div class="text-sm text-gray-500">Sa</div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-center">
              <div id="cd-tA" class="colcell">${tA}</div>
              <div id="cd-oA" class="colcell">${oA}</div>
              <div class="col-span-2 h-[2px] bg-gray-300 my-1"></div>
              <div id="cd-tB" class="colcell">âˆ’ ${tB}</div>
              <div id="cd-oB" class="colcell">âˆ’ ${oB}</div>
              <div class="col-span-2 h-[2px] bg-gray-300 my-1"></div>
              <div id="cd-tR" class="colcell">= ?</div>
              <div id="cd-oR" class="colcell">= ?</div>
            </div>
          </div>

          <div class="flex-1">
            <div class="bg-white border rounded-xl p-4">
              <div class="text-sm text-gray-500 mb-2">Panduan langkah</div>
              <ol class="list-decimal list-inside text-gray-700 space-y-1" id="cd-steps">
                <li>Mulakan dari <b>Sa</b> (kanan).</li>
                <li>Kira: ${oA} âˆ’ ${oB}.</li>
                <li>Isi hasil di lajur Sa.</li>
                <li>Teruskan ke <b>Puluh</b>.</li>
                <li>Kira: ${tA} âˆ’ ${tB}.</li>
                <li>Isi hasil di lajur Puluh.</li>
              </ol>
              <div class="flex gap-3 mt-3">
                <button class="step bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg" onclick="cdPlay()">Tunjuk Langkah</button>
                <button class="step bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg" onclick="loadColumnDemo(document.getElementById('activity-content'))">Contoh Baharu</button>
              </div>
              <div class="mt-3 text-lg"><span class="text-gray-500">Jawapan penuh:</span> <b id="cd-ans">${A} âˆ’ ${B} = ${ans}</b></div>
            </div>
          </div>
        </div>
      `;
      window.cdPlay = async ()=>{
        const sleep = ms => new Promise(r=>setTimeout(r,ms));
        const oR = oA - oB, tR = tA - tB;
        const oAEl = document.getElementById('cd-oA');
        const oBEl = document.getElementById('cd-oB');
        const oREl = document.getElementById('cd-oR');
        const tAEl = document.getElementById('cd-tA');
        const tBEl = document.getElementById('cd-tB');
        const tREl = document.getElementById('cd-tR');

        // Sa
        [oAEl,oBEl].forEach(e=>e.classList.add('hl')); speak("Mula di sa, tolak unit.");
        await sleep(900);
        oREl.textContent = `= ${oR}`; oREl.classList.add('hl');
        await sleep(900);
        [oAEl,oBEl,oREl].forEach(e=>e.classList.remove('hl'));

        // Puluh
        [tAEl,tBEl].forEach(e=>e.classList.add('hl')); speak("Teruskan ke puluh.");
        await sleep(900);
        tREl.textContent = `= ${tR}`; tREl.classList.add('hl');
        await sleep(900);
        [tAEl,tBEl,tREl].forEach(e=>e.classList.remove('hl'));
        speak("Selesai. Inilah cara tolak tanpa mengumpul semula.");
      };
    }

    /* ===== 5) Cerita Bergambar â€“ Tolak Objek ===== */
    function loadStory(content){
      const sets = [
        {icon:"ğŸ", name:"Buah"},
        {icon:"ğŸ•Šï¸", name:"Burung"},
        {icon:"ğŸ¦‹", name:"Rama-rama"},
        {icon:"âš½ï¸", name:"Bola"}
      ];
      let sel=sets[R(0,sets.length-1)];
      let start = R(6,15), left = start;

      setInfo("Bina cerita sendiri: pilih objek, tetapkan jumlah mula, kemudian klik 'Hilangkan' untuk melihat ayat cerita.");
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-rose-600 mb-2">ğŸï¸ Cerita Bergambar â€“ Tolak</h3>

        <div class="flex flex-col lg:flex-row gap-6">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-sm text-gray-500">Objek:</span>
              <div class="flex gap-2">
                ${sets.map(s=>`<button class="story-obj ${s.icon===sel.icon?'ring-4 ring-rose-300':''}"
                         onclick="chooseStory('${s.icon}','${s.name}')">${s.icon}</button>`).join('')}
              </div>
            </div>

            <div class="flex items-center gap-3 mb-3">
              <span class="text-sm text-gray-500">Jumlah mula:</span>
              <input id="st-range" type="range" min="3" max="20" value="${start}">
              <span id="st-val" class="font-bold">${start}</span>
              <button class="step bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-lg" onclick="stReset()">Set</button>
            </div>

            <div id="st-canvas" class="min-h-24 bg-white border rounded-xl p-3 flex flex-wrap gap-2">
              ${Array.from({length:start},()=>`<div class="story-obj">${sel.icon}</div>`).join('')}
            </div>

            <div class="flex flex-wrap gap-2 mt-3">
              <button class="step bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-lg" onclick="stRemove(1)">Hilangkan 1</button>
              <button class="step bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-lg" onclick="stRemove(2)">Hilangkan 2</button>
              <button class="step bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-lg" onclick="stRemove(3)">Hilangkan 3</button>
              <button class="step bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg" onclick="stReset()">Reset</button>
            </div>
          </div>

          <div class="w-full lg:w-80">
            <div class="bg-white border rounded-xl p-4">
              <div class="text-sm text-gray-500">Ayat cerita</div>
              <p id="st-sent" class="text-lg font-semibold text-gray-800 mt-1">
                Ada <b>${start}</b> ${sel.name.toLowerCase()}. Selepas beberapa ${sel.name.toLowerCase()} hilang, tinggal <b>${left}</b>.
              </p>
              <div class="text-sm text-gray-500 mt-2">Ayat matematik: <span id="st-eq" class="font-bold">${start} âˆ’ 0 = ${left}</span></div>
            </div>
          </div>
        </div>
      `;
      window.chooseStory = (icon,name)=>{
        sel={icon, name}; stReset();
      };
      window.stRemove = (n)=>{
        const can = document.getElementById('st-canvas');
        for(let i=0;i<n;i++){ if(can.firstElementChild) can.firstElementChild.remove(); }
        left = Math.max(0, left-n);
        document.getElementById('st-sent').innerHTML = `Ada <b>${start}</b> ${sel.name.toLowerCase()}. Selepas <b>${start-left}</b> hilang, tinggal <b>${left}</b>.`;
        document.getElementById('st-eq').textContent = `${start} âˆ’ ${start-left} = ${left}`;
        speak(`${n} hilang. Tinggal ${left}.`);
      };
      window.stReset = ()=>{
        start = parseInt(document.getElementById('st-range').value);
        left  = start;
        document.getElementById('st-val').textContent=start;
        const can = document.getElementById('st-canvas');
        can.innerHTML = Array.from({length:start},()=>`<div class="story-obj">${sel.icon}</div>`).join('');
        document.getElementById('st-sent').innerHTML = `Ada <b>${start}</b> ${sel.name.toLowerCase()}. Selepas beberapa ${sel.name.toLowerCase()} hilang, tinggal <b>${left}</b>.`;
        document.getElementById('st-eq').textContent = `${start} âˆ’ 0 = ${left}`;
        setInfo(`Cerita ${sel.name}. Jumlah mula ${start}.`);
      };
    }

    // Auto-resume TTS pada sesetengah pelayar
    if ('speechSynthesis' in window) {
      setInterval(() => { if (window.speechSynthesis.paused) window.speechSynthesis.resume(); }, 1000);
    }
  </script>
</body>
</html>
